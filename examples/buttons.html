<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Buttons Example</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
    <style>
      body { padding: 10px 0; }
      .container { max-width: 730px; }
    </style>
    <script src="../dist/bulb.js"></script>
  </head>
  <body>
    <div class="container">
      <div id="pinpad" class="container">
        <div class="row">
          <div class="col">
            <button type="button" class="btn btn-dark" data-value="1">1</button>
          </div>
          <div class="col">
            <button type="button" class="btn btn-dark" data-value="2">2</button>
          </div>
          <div class="col">
            <button type="button" class="btn btn-dark" data-value="3">3</button>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <button type="button" class="btn btn-dark" data-value="4">4</button>
          </div>
          <div class="col">
            <button type="button" class="btn btn-dark" data-value="5">5</button>
          </div>
          <div class="col">
            <button type="button" class="btn btn-dark" data-value="6">6</button>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <button type="button" class="btn btn-dark" data-value="7">7</button>
          </div>
          <div class="col">
            <button type="button" class="btn btn-dark" data-value="8">8</button>
          </div>
          <div class="col">
            <button type="button" class="btn btn-dark" data-value="9">9</button>
          </div>
        </div>
      </div>

      <h2>Results</h2>
      <pre><code id="results"></code></pre>
    </div>

    <script>
      const PIN_LENGTH = 4

      const showValue = value =>
        document
          .getElementById('results')
          .appendChild(document.createTextNode(value + '\n'))

      const lengthEqualTo = n => a => a.length === n
      const prependNumber = (as, a) => as.length < PIN_LENGTH ? as + a : a
      const buttons = Array.from(document.getElementById('pinpad').querySelectorAll('button'))
      const buttonSignal = button => bulb.Signal.fromEvent('click', button).map(() => button.dataset.value)
      const buttonSignals = buttons.map(buttonSignal)
      const valueSignal = bulb.merge(buttonSignals)
      const attemptSignal = valueSignal.scan(prependNumber, '')
      const pinSignal = attemptSignal.filter(lengthEqualTo(PIN_LENGTH))

      pinSignal.subscribe(showValue)
    </script>
  </body>
</html>
